var crypto=require("crypto");require("events");require("fs");var http=require("http"),sql=require("sqlite3");require("url");var util=require("util");crypto.randomBytes(4).readUInt32LE(0);function e(a){this.y=a}function g(a){a.y^=a.y<<13;a.y>>=17;a.y^=a.y<<5;return a.y}function j(a){this.a=new e(a);this.key=g(this.a);this.g=0}
function l(a,c){this.db=new sql.Database(a,sql.OPEN_READWRITE|sql.OPEN_CREATE,this.d.bind(this));this.a=new e(crypto.randomBytes(4).readUInt32LE(0));this.e=new j(g(this.a));this.f=c}util.inherits(l,require("events").EventEmitter);l.prototype.d=function(a){null!==a?(util.error(a),process.exit(43)):(this.db.run("CREATE TABLE IF NOT EXISTS flags ( flag TEXT, key INT )"),this.emit("init"))};
function m(){function a(a){for(var d=c.c,b=c.b,w=c.a,i=b.slice(0),q={},k=0;k<b.length;k++){for(var f=g(w)%b.length;void 0===i[f];)f=(f+1)%i.length;q[b[k]]=i[f];i[f]=void 0}d[a]=q}var c=this;this.a=new e(9237503);this.b="0123456789abcdef".split("");this.start="a";this.c={};var d=[];this.b.forEach(function(c){d.push(a(c))});this.a.y=crypto.randomBytes(4).readUInt32LE(0)}
function n(){for(var a=r,c=s,d="",h=a.start,p=0;19>p;p++)var b=a.b[g(a.a)%a.b.length],d=d+b,h=a.c[h][b];for(b in a.c[h])if(a.c[h][b]==c){d+=b;break}return d};var t=process.argv[2];if("get"==t||"set"==t||"rep"==t){var r=new m,u=process.argv[3],v=parseInt(process.argv[4]),x=process.argv[5],y="set"==t?process.argv[5]:process.argv[6],s="5",z="?id="+x;"set"==t?(s="8",z="?flag="+y):"rep"==t&&(s="3",z="?id="+x+"&flag="+y);var A=http.request({hostname:u,port:v,path:"/afd/"+n()+z},null);A.on("response",function(a){a.on("data",function(a){console.log(a.toString("utf8"))})});A.end()};
